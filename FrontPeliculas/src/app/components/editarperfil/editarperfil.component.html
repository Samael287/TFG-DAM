<div class="container"> 
  <h2 class="text-center">Editar Perfil</h2>
  
  <!-- Verificación de contraseña -->
  <div *ngIf="!verificado">
    <label for="passwordActual">Introduce tu contraseña actual:</label>
    <input type="password" class="form-control" [(ngModel)]="passwordActual" name="passwordActual">
    <button class="btn btn-primary mt-2" (click)="verificarPassword()">Verificar</button>
  </div>

  <!-- Formulario de edición (si se ha verificado la contraseña) -->
  <div *ngIf="verificado">
    <form (ngSubmit)="actualizarPerfil()">
      <div class="mb-3">
        <label>Nombre:</label>
        <input type="text" class="form-control" [(ngModel)]="usuario.nombre" name="nombre">
      </div>
      <div class="mb-3">
        <label>Apellidos:</label>
        <input type="text" class="form-control" [(ngModel)]="usuario.apellidos" name="apellidos">
      </div>
      <div class="mb-3">
        <label>Email:</label>
        <input type="email" class="form-control" [(ngModel)]="usuario.email" name="email">
      </div>
      <div class="mb-3">
        <label>Nueva Contraseña (opcional):</label>
        <input type="password" class="form-control" [(ngModel)]="nuevaPassword" name="nuevaPassword">
      </div>
      <div class="mb-3">
        <label>Confirmar Nueva Contraseña:</label>
        <input type="password" class="form-control" [(ngModel)]="confirmarPassword" name="confirmarPassword">
      </div>
      
      <!-- Sección de Tarjeta -->
      <div class="mb-3">
        <h3 class="mt-3">Información de Tarjeta</h3>
        <!-- Si el usuario ya tiene tarjeta asociada, se muestran sus datos -->
        <div *ngIf="usuario.tarjeta; else sinTarjeta">
          <div class="mb-3">
            <label>Número de Tarjeta:</label>
            <input type="text" class="form-control" [(ngModel)]="tarjeta.numeroTarjeta" name="numeroTarjeta">
          </div>
          <div class="mb-3">
            <label>Fecha de Caducidad:</label>
            <input type="date" class="form-control" [(ngModel)]="tarjeta.fechaCaducidad" name="fechaCaducidad">
          </div>
          <div class="mb-3">
            <label>Código de Seguridad:</label>
            <input type="text" class="form-control" [(ngModel)]="tarjeta.numeroSeguridad" name="numeroSeguridad">
          </div>
          <!-- Nuevo campo para Fondos Disponibles -->
          <div class="mb-3">
            <label>Fondos Disponibles:</label>
            <input type="number" class="form-control" [(ngModel)]="tarjeta.fondosDisponibles" name="fondosDisponibles">
          </div>
        </div>
        <!-- Si no tiene tarjeta, se muestra el botón para añadirla y luego se muestran los campos -->
        <ng-template #sinTarjeta>
          <button type="button" class="btn btn-primary" (click)="activarFormularioTarjeta()">Añadir Tarjeta</button>
          <div *ngIf="mostrarFormularioTarjeta" class="mt-3">
            <div class="mb-3">
              <label>Número de Tarjeta:</label>
              <input type="text" class="form-control" [(ngModel)]="tarjeta.numeroTarjeta" name="numeroTarjeta">
            </div>
            <div class="mb-3">
              <label>Fecha de Caducidad:</label>
              <input type="date" class="form-control" [(ngModel)]="tarjeta.fechaCaducidad" name="fechaCaducidad">
            </div>
            <div class="mb-3">
              <label>Código de Seguridad:</label>
              <input type="text" class="form-control" [(ngModel)]="tarjeta.numeroSeguridad" name="numeroSeguridad">
            </div>
            <!-- Nuevo campo para Fondos Disponibles -->
            <div class="mb-3">
              <label>Fondos Disponibles:</label>
              <input type="number" class="form-control" [(ngModel)]="tarjeta.fondosDisponibles" name="fondosDisponibles">
            </div>
          </div>
        </ng-template>
      </div>
      <button type="submit" class="btn btn-success">Guardar Cambios</button>
    </form>
  </div>
</div>
